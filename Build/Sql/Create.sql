-- Versão 1

CREATE TABLE USUARIOS (
	LOGIN varchar(15) NOT NULL,
	SENHA varchar(20) NOT NULL,
	ULTIMO_ACESSO datetime NULL,
    CONSTRAINT PK_USUARIOS PRIMARY KEY CLUSTERED (LOGIN ASC)
);

CREATE TABLE TIPOS_PRODUTO (
	CODIGO char(3) NOT NULL,
	DESCRICAO varchar(60) NOT NULL,
    CONSTRAINT PK_TIPOS_PRODUTO PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE PRODUTOS (
	CODIGO char(6) NOT NULL,
	CODIGO_TIPO_PRODUTO char(3) NOT NULL,
	DESCRICAO varchar(60) NOT NULL,
	CODIGO_BARRAS varchar(20) NULL,
	PRECO_VENDA float NOT NULL CONSTRAINT DF_PRODUTOS_PRECO_VENDA DEFAULT ((0)),
    CONSTRAINT PK_PRODUTOS PRIMARY KEY CLUSTERED (CODIGO ASC)
);

ALTER TABLE PRODUTOS WITH CHECK ADD CONSTRAINT FK_PRODUTOS_TIPOS_PRODUTO FOREIGN KEY(CODIGO_TIPO_PRODUTO)
REFERENCES TIPOS_PRODUTO (CODIGO) ON UPDATE CASCADE;

CREATE TABLE FORNECEDORES (
	CODIGO char(3) NOT NULL,
	NOME varchar(60) NOT NULL,
	TELEFONE char(10) NULL,
    CONSTRAINT PK_FORNECEDORES PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE FORNECEDORES_PRODUTO (
	CODIGO_PRODUTO char(6) NOT NULL,
	CODIGO_FORNECEDOR char(3) NOT NULL,
	PRECO_COMPRA float NOT NULL CONSTRAINT [DF_FORNECEDORES_PRODUTO_PRECO_COMPRA]  DEFAULT ((0)),
	CONSTRAINT PK_FORNECEDORES_PRODUTO PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC, CODIGO_FORNECEDOR ASC)
);

ALTER TABLE FORNECEDORES_PRODUTO WITH CHECK ADD CONSTRAINT FK_FORNECEDORES_PRODUTO_FORNECEDORES FOREIGN KEY(CODIGO_FORNECEDOR)
REFERENCES FORNECEDORES (CODIGO) ON UPDATE CASCADE;

ALTER TABLE FORNECEDORES_PRODUTO WITH CHECK ADD CONSTRAINT FK_FORNECEDORES_PRODUTO_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

CREATE TABLE VALIDADES (
	CODIGO_PRODUTO char(6) NOT NULL,
	DATA datetime NOT NULL,
	CONSTRAINT PK_VALIDADES PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC, DATA ASC)
);

ALTER TABLE VALIDADES WITH CHECK ADD CONSTRAINT FK_VALIDADES_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO);

CREATE TABLE ESTOQUE (
	CODIGO_PRODUTO char(6) NOT NULL,
	QUANTIDADE int NOT NULL CONSTRAINT DF_ESTOQUE_QUANTIDADE DEFAULT ((0)),
	CONSTRAINT PK_ESTOQUE PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC)
);

ALTER TABLE ESTOQUE WITH CHECK ADD CONSTRAINT FK_ESTOQUE_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

CREATE TABLE PEDIDOS_VENDA (
	CODIGO char(6) NOT NULL,
	DATA datetime NOT NULL,
	DESCONTO float NOT NULL CONSTRAINT DF_PEDIDOS_VENDA_DESCONTO DEFAULT ((0)),
	TIPO_PAGAMENTO [int] NOT NULL CONSTRAINT DF_PEDIDOS_VENDA_TIPO_PAGAMENTO DEFAULT ((0)),
	CONSTRAINT [PK_PEDIDOS_VENDA] PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE ITENS_PEDIDO_VENDA (
	CODIGO_PEDIDO char(6) NOT NULL,
	CODIGO_PRODUTO char(6) NOT NULL,
	QUANTIDADE int NOT NULL CONSTRAINT DF_ITENS_PEDIDO_VENDA_QUANTIDADE DEFAULT ((0)),
	CONSTRAINT PK_ITENS_PEDIDO_VENDA PRIMARY KEY CLUSTERED (CODIGO_PEDIDO ASC, CODIGO_PRODUTO ASC)
);

ALTER TABLE ITENS_PEDIDO_VENDA WITH CHECK ADD CONSTRAINT FK_ITENS_PEDIDO_VENDA_PEDIDOS_VENDA FOREIGN KEY(CODIGO_PEDIDO)
REFERENCES PEDIDOS_VENDA (CODIGO);

ALTER TABLE ITENS_PEDIDO_VENDA WITH CHECK ADD CONSTRAINT FK_ITENS_PEDIDO_VENDA_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

-- Versão 2

CREATE TABLE CLIENTES (
	CODIGO char(6) NOT NULL,
	NOME varchar(60) NOT NULL,
        TELEFONE char(10) NULL,
	CONSTRAINT PK_CLIENTES PRIMARY KEY CLUSTERED (CODIGO ASC)
);

ALTER TABLE PEDIDOS_VENDA ADD CODIGO_CLIENTE CHAR(6);

ALTER TABLE PEDIDOS_VENDA WITH CHECK ADD CONSTRAINT FK_PEDIDOS_VENDA_CLIENTES FOREIGN KEY(CODIGO_CLIENTE)
REFERENCES CLIENTES (CODIGO) ON UPDATE CASCADE;

-- Versão 3

ALTER TABLE PEDIDOS_VENDA ADD NOME_CLIENTE_AVULSO VARCHAR(60);

-- Versão 4

ALTER TABLE PEDIDOS_VENDA ADD FECHADA bit NOT NULL DEFAULT 0;

-- Versão 5

ALTER TABLE PRODUTOS ADD ESTOQUE_MINIMO int NOT NULL DEFAULT 0;

-- Versão 6

ALTER TABLE PEDIDOS_VENDA ADD DESCONTO_PERCENTUAL float NOT NULL DEFAULT 0;

-- Versão 7

ALTER TABLE PEDIDOS_VENDA ADD TOTAL float NOT NULL DEFAULT 0;

ALTER TABLE PEDIDOS_VENDA ADD CANCELADA bit NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD DESCONTO_VALOR float NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD DESCONTO_PERCENTUAL float NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD VALOR float NOT NULL DEFAULT 0;

ALTER TABLE PRODUTOS ADD ENDERECO varchar(50);

-- Versao 8

CREATE TABLE INFO (
	VERSAO_BD int
);

ALTER TABLE PEDIDOS_VENDA ADD RECEBIDO float NOT NULL DEFAULT 0;

ALTER TABLE PEDIDOS_VENDA ADD TROCO float NOT NULL DEFAULT 0;

Insert Into INFO values (8);

