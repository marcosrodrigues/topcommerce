-- Versão 1

CREATE TABLE USUARIOS (
	LOGIN varchar(15) NOT NULL,
	SENHA varchar(20) NOT NULL,
	ULTIMO_ACESSO datetime NULL,
    CONSTRAINT PK_USUARIOS PRIMARY KEY CLUSTERED (LOGIN ASC)
);

CREATE TABLE TIPOS_PRODUTO (
	CODIGO char(3) NOT NULL,
	DESCRICAO varchar(60) NOT NULL,
    CONSTRAINT PK_TIPOS_PRODUTO PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE PRODUTOS (
	CODIGO char(6) NOT NULL,
	CODIGO_TIPO_PRODUTO char(3) NOT NULL,
	DESCRICAO varchar(60) NOT NULL,
	CODIGO_BARRAS varchar(20) NULL,
	PRECO_VENDA float NOT NULL CONSTRAINT DF_PRODUTOS_PRECO_VENDA DEFAULT ((0)),
    CONSTRAINT PK_PRODUTOS PRIMARY KEY CLUSTERED (CODIGO ASC)
);

ALTER TABLE PRODUTOS WITH CHECK ADD CONSTRAINT FK_PRODUTOS_TIPOS_PRODUTO FOREIGN KEY(CODIGO_TIPO_PRODUTO)
REFERENCES TIPOS_PRODUTO (CODIGO) ON UPDATE CASCADE;

CREATE TABLE FORNECEDORES (
	CODIGO char(3) NOT NULL,
	NOME varchar(60) NOT NULL,
	TELEFONE char(10) NULL,
    CONSTRAINT PK_FORNECEDORES PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE FORNECEDORES_PRODUTO (
	CODIGO_PRODUTO char(6) NOT NULL,
	CODIGO_FORNECEDOR char(3) NOT NULL,
	PRECO_COMPRA float NOT NULL CONSTRAINT [DF_FORNECEDORES_PRODUTO_PRECO_COMPRA]  DEFAULT ((0)),
	CONSTRAINT PK_FORNECEDORES_PRODUTO PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC, CODIGO_FORNECEDOR ASC)
);

ALTER TABLE FORNECEDORES_PRODUTO WITH CHECK ADD CONSTRAINT FK_FORNECEDORES_PRODUTO_FORNECEDORES FOREIGN KEY(CODIGO_FORNECEDOR)
REFERENCES FORNECEDORES (CODIGO) ON UPDATE CASCADE;

ALTER TABLE FORNECEDORES_PRODUTO WITH CHECK ADD CONSTRAINT FK_FORNECEDORES_PRODUTO_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

CREATE TABLE VALIDADES (
	CODIGO_PRODUTO char(6) NOT NULL,
	DATA datetime NOT NULL,
	CONSTRAINT PK_VALIDADES PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC, DATA ASC)
);

ALTER TABLE VALIDADES WITH CHECK ADD CONSTRAINT FK_VALIDADES_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO);

CREATE TABLE ESTOQUE (
	CODIGO_PRODUTO char(6) NOT NULL,
	QUANTIDADE int NOT NULL CONSTRAINT DF_ESTOQUE_QUANTIDADE DEFAULT ((0)),
	CONSTRAINT PK_ESTOQUE PRIMARY KEY CLUSTERED (CODIGO_PRODUTO ASC)
);

ALTER TABLE ESTOQUE WITH CHECK ADD CONSTRAINT FK_ESTOQUE_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

CREATE TABLE PEDIDOS_VENDA (
	CODIGO char(6) NOT NULL,
	DATA datetime NOT NULL,
	DESCONTO float NOT NULL CONSTRAINT DF_PEDIDOS_VENDA_DESCONTO DEFAULT ((0)),
	TIPO_PAGAMENTO [int] NOT NULL CONSTRAINT DF_PEDIDOS_VENDA_TIPO_PAGAMENTO DEFAULT ((0)),
	CONSTRAINT [PK_PEDIDOS_VENDA] PRIMARY KEY CLUSTERED (CODIGO ASC)
);

CREATE TABLE ITENS_PEDIDO_VENDA (
	CODIGO_PEDIDO char(6) NOT NULL,
	CODIGO_PRODUTO char(6) NOT NULL,
	QUANTIDADE int NOT NULL CONSTRAINT DF_ITENS_PEDIDO_VENDA_QUANTIDADE DEFAULT ((0)),
	CONSTRAINT PK_ITENS_PEDIDO_VENDA PRIMARY KEY CLUSTERED (CODIGO_PEDIDO ASC, CODIGO_PRODUTO ASC)
);

ALTER TABLE ITENS_PEDIDO_VENDA WITH CHECK ADD CONSTRAINT FK_ITENS_PEDIDO_VENDA_PEDIDOS_VENDA FOREIGN KEY(CODIGO_PEDIDO)
REFERENCES PEDIDOS_VENDA (CODIGO);

ALTER TABLE ITENS_PEDIDO_VENDA WITH CHECK ADD CONSTRAINT FK_ITENS_PEDIDO_VENDA_PRODUTOS FOREIGN KEY(CODIGO_PRODUTO)
REFERENCES PRODUTOS (CODIGO) ON UPDATE CASCADE;

-- Versão 2

CREATE TABLE CLIENTES (
	CODIGO char(6) NOT NULL,
	NOME varchar(60) NOT NULL,
        TELEFONE char(10) NULL,
	CONSTRAINT PK_CLIENTES PRIMARY KEY CLUSTERED (CODIGO ASC)
);

ALTER TABLE PEDIDOS_VENDA ADD CODIGO_CLIENTE CHAR(6);

ALTER TABLE PEDIDOS_VENDA WITH CHECK ADD CONSTRAINT FK_PEDIDOS_VENDA_CLIENTES FOREIGN KEY(CODIGO_CLIENTE)
REFERENCES CLIENTES (CODIGO) ON UPDATE CASCADE;

-- Versão 3

ALTER TABLE PEDIDOS_VENDA ADD NOME_CLIENTE_AVULSO VARCHAR(60);

-- Versão 4

ALTER TABLE PEDIDOS_VENDA ADD FECHADA bit NOT NULL DEFAULT 0;

-- Versão 5

ALTER TABLE PRODUTOS ADD ESTOQUE_MINIMO int NOT NULL DEFAULT 0;

-- Versão 6

ALTER TABLE PEDIDOS_VENDA ADD DESCONTO_PERCENTUAL float NOT NULL DEFAULT 0;

-- Versão 7

ALTER TABLE PEDIDOS_VENDA ADD TOTAL float NOT NULL DEFAULT 0;

ALTER TABLE PEDIDOS_VENDA ADD CANCELADA bit NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD DESCONTO_VALOR float NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD DESCONTO_PERCENTUAL float NOT NULL DEFAULT 0;

ALTER TABLE ITENS_PEDIDO_VENDA ADD VALOR float NOT NULL DEFAULT 0;

ALTER TABLE PRODUTOS ADD ENDERECO varchar(50);

-- Versao 8

CREATE TABLE INFO (
	VERSAO_BD int
);

ALTER TABLE PEDIDOS_VENDA ADD RECEBIDO float NOT NULL DEFAULT 0;

ALTER TABLE PEDIDOS_VENDA ADD TROCO float NOT NULL DEFAULT 0;

Insert Into INFO values (8);

-- Versao 9

ALTER TABLE PEDIDOS_VENDA ADD LOGIN_USUARIO varchar(15);

ALTER TABLE PEDIDOS_VENDA WITH CHECK ADD CONSTRAINT FK_PEDIDOS_VENDA_USUARIOS FOREIGN KEY(LOGIN_USUARIO)
REFERENCES USUARIOS (LOGIN) ON UPDATE CASCADE;

CREATE TABLE [dbo].[CAIXAS](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[DATA] [datetime] NOT NULL,
	[FECHADO] [bit] NOT NULL,
	[VALOR_ABERTURA] [float] NULL,
 CONSTRAINT [PK_CAIXAS] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [dbo].[CAIXAS] ADD  CONSTRAINT [DF_CAIXAS_FECHADO]  DEFAULT ((0)) FOR [FECHADO]
GO

CREATE TABLE [dbo].[MOVIMENTACOES_CAIXA](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CAIXA_ID] [int] NOT NULL,
	[ORIGEM] [int] NOT NULL,
	[VALOR] [float] NOT NULL,
	[OPERACAO] [int] NOT NULL,
 CONSTRAINT [PK_MOVIMENTACOES_CAIXA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [dbo].[MOVIMENTACOES_CAIXA]  WITH CHECK ADD  CONSTRAINT [FK_MOVIMENTACOES_CAIXA_CAIXAS] FOREIGN KEY([CAIXA_ID])
REFERENCES [dbo].[CAIXAS] ([ID])
ON UPDATE CASCADE
ON DELETE CASCADE
GO

ALTER TABLE [dbo].[MOVIMENTACOES_CAIXA] CHECK CONSTRAINT [FK_MOVIMENTACOES_CAIXA_CAIXAS]
GO

Update INFO set VERSAO_BD = 9;

-- Versao 10

CREATE TABLE [dbo].[CONTAS_PAGAR](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[FORNECEDOR_CODIGO] [char](3) COLLATE Latin1_General_CI_AS NOT NULL,
	[VENCIMENTO] [datetime] NOT NULL,
	[VALOR] [float] NOT NULL,
	[OBSERVACOES] [text] COLLATE Latin1_General_CI_AS NULL,
	[BAIXADA] [bit] NOT NULL CONSTRAINT [DF_CONTAS_PAGAR_BAIXADA]  DEFAULT ((0)),
 CONSTRAINT [PK_CONTAS_PAGAR] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
USE [TopCommerce]
GO
ALTER TABLE [dbo].[CONTAS_PAGAR]  WITH CHECK ADD  CONSTRAINT [FK_CONTAS_PAGAR_FORNECEDORES] FOREIGN KEY([FORNECEDOR_CODIGO])
REFERENCES [dbo].[FORNECEDORES] ([CODIGO])

USE [TopCommerce]
GO
/****** Object:  Table [dbo].[CONTAS_RECEBER]    Script Date: 10/01/2013 21:34:16 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[CONTAS_RECEBER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CLIENTE_CODIGO] [char](6) COLLATE Latin1_General_CI_AS NULL,
	[NOME_CLIENTE_AVULSO] [varchar](60) COLLATE Latin1_General_CI_AS NULL,
	[VENCIMENTO] [datetime] NOT NULL,
	[VALOR] [float] NOT NULL,
	[OBSERVACOES] [text] COLLATE Latin1_General_CI_AS NULL,
	[BAIXADA] [bit] NOT NULL CONSTRAINT [DF_CONTAS_RECEBER_BAIXADA]  DEFAULT ((0)),
 CONSTRAINT [PK_CONTAS_RECEBER] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
USE [TopCommerce]
GO
ALTER TABLE [dbo].[CONTAS_RECEBER]  WITH CHECK ADD  CONSTRAINT [FK_CONTAS_RECEBER_CLIENTES] FOREIGN KEY([CLIENTE_CODIGO])
REFERENCES [dbo].[CLIENTES] ([CODIGO])

Update INFO set VERSAO_BD = 10;

-- Versao 11

ALTER TABLE dbo.PRODUTOS ADD
	MARGEM_LUCRO float(53) NULL,
	DESCONTO_MAXIMO_VALOR float(53) NULL,
	DESCONTO_MAXIMO_PERCENTUAL float(53) NULL
GO

Update INFO set VERSAO_BD = 11;

-- Versao 12

CREATE TABLE [dbo].[CARGOS](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[DESCRICAO] [varchar](150) NOT NULL,
 CONSTRAINT [PK_CARGOS] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

CREATE TABLE [dbo].[FUNCIONARIOS](
	[CODIGO] [char](6) NOT NULL,
	[NOME] [varchar](150) NOT NULL,
	[CARGO_ID] [int] NOT NULL,
 CONSTRAINT [PK_FUNCIONARIOS] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [dbo].[FUNCIONARIOS]  WITH CHECK ADD  CONSTRAINT [FK_FUNCIONARIOS_CARGOS] FOREIGN KEY([CARGO_ID])
REFERENCES [dbo].[CARGOS] ([ID])
GO

ALTER TABLE [dbo].[FUNCIONARIOS] CHECK CONSTRAINT [FK_FUNCIONARIOS_CARGOS]
GO

Update INFO set VERSAO_BD = 12;